<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RYO Boosting</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.19/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; }
    </style>
</head>
<body class="min-h-screen bg-base-200">
    <!-- Navbar -->
    <div class="navbar bg-base-100 shadow-lg">
        <div class="flex-1">
            <a class="btn btn-ghost text-xl">
                <i data-feather="zap" class="w-6 h-6 mr-2"></i>
                RYOBOOSTING
            </a>
        </div>
        <div class="flex-none">
            <button class="btn btn-ghost" onclick="toggleTheme()">
                <i data-feather="moon" class="w-5 h-5"></i>
            </button>
        </div>
    </div>

    <div class="container mx-auto p-4">
        <!-- Share Form -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title"><i data-feather="share-2" class="w-6 h-6"></i> Start Share Process</h2>
                <form id="shareForm" class="space-y-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Cookies</span>
                        </label>
                        <textarea class="textarea textarea-bordered" id="cookies" rows="3"></textarea>
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Post Link</span>
                        </label>
                        <input type="text" id="postLink" class="input input-bordered">
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Share Count</span>
                        </label>
                        <input type="number" id="shareCount" class="input input-bordered">
                    </div>
                    <button type="submit" class="btn btn-primary w-full">
                        <i data-feather="play" class="w-4 h-4 mr-2"></i>
                        Start Share
                    </button>
                </form>
            </div>
        </div>

        <!-- Active Processes -->
        <div class="card bg-base-100 shadow-xl mt-6">
            <div class="card-body">
                <h2 class="card-title">
                    <i data-feather="activity" class="w-6 h-6"></i>
                    Active Processes
                </h2>
                <div id="activeProcesses" class="space-y-4"></div>
            </div>
        </div>

        <!-- Logs -->
        <div class="card bg-base-100 shadow-xl mt-6">
            <div class="card-body">
                <div class="flex justify-between items-center">
                    <h2 class="card-title">
                        <i data-feather="list" class="w-6 h-6"></i>
                        Logs
                    </h2>
                    <button class="btn btn-sm btn-ghost" onclick="clearLogs()">
                        <i data-feather="trash-2" class="w-4 h-4"></i>
                        Clear
                    </button>
                </div>
                <div id="logs" class="mt-4 space-y-2 h-64 overflow-y-auto"></div>
            </div>
        </div>
    </div>

    <!-- Admin Password Modal -->
    <dialog id="adminModal" class="modal">
        <div class="modal-box">
            <h3 class="font-bold text-lg">Admin Authentication Required</h3>
            <div class="form-control mt-4">
                <input type="password" id="adminPassword" class="input input-bordered" placeholder="Enter admin password">
            </div>
            <div class="modal-action">
                <button class="btn btn-error" onclick="closeAdminModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmAdminAction()">Confirm</button>
            </div>
        </div>
    </dialog>

    <script>
        feather.replace();
        const API_URL = 'https://ryoboostingapi.onrender.com';
        let pendingAction = null;

        function toggleTheme() {
            const html = document.querySelector('html');
            const currentTheme = html.getAttribute('data-theme');
            html.setAttribute('data-theme', currentTheme === 'dark' ? 'light' : 'dark');
        }

        async function startShare(event) {
            event.preventDefault();
            const data = {
                cookies: document.getElementById('cookies').value,
                post_link: document.getElementById('postLink').value,
                share_count: parseInt(document.getElementById('shareCount').value)
            };

            try {
                const response = await fetch(`${API_URL}/start_share`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                updateProcesses();
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function stopProcess(processId) {
            pendingAction = { type: 'stop', processId };
            document.getElementById('adminModal').showModal();
        }

        async function deleteProcess(processId) {
            pendingAction = { type: 'delete', processId };
            document.getElementById('adminModal').showModal();
        }

        function closeAdminModal() {
            document.getElementById('adminModal').close();
            pendingAction = null;
        }

        async function confirmAdminAction() {
            const password = document.getElementById('adminPassword').value;
            if (!pendingAction) return;

            const endpoint = pendingAction.type === 'stop' ? 'stop_share' : 'delete_share';
            try {
                const response = await fetch(`${API_URL}/${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        process_id: pendingAction.processId,
                        password: password
                    })
                });
                const result = await response.json();
                updateProcesses();
                closeAdminModal();
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function updateProcesses() {
            try {
                const response = await fetch(`${API_URL}/active_processes`);
                const processes = await response.json();
                const container = document.getElementById('activeProcesses');
                container.innerHTML = '';

                for (const [id, process] of Object.entries(processes)) {
                    const processElement = document.createElement('div');
                    processElement.className = 'card bg-base-200';
                    processElement.innerHTML = `
                        <div class="card-body">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h3 class="font-semibold">Process ID: ${id.substr(0, 8)}</h3>
                                    <p class="text-sm">Post: ${process.post_link}</p>
                                    <div class="mt-2">
                                        <progress class="progress progress-primary w-56" 
                                                value="${process.progress}" max="100"></progress>
                                        <span class="text-sm">${process.current_count}/${process.share_count}</span>
                                    </div>
                                </div>
                                <div class="space-x-2">
                                    <button class="btn btn-sm btn-warning" onclick="stopProcess('${id}')">
                                        <i data-feather="pause" class="w-4 h-4"></i>
                                    </button>
                                    <button class="btn btn-sm btn-error" onclick="deleteProcess('${id}')">
                                        <i data-feather="trash" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(processElement);
                }
                feather.replace();
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function updateLogs() {
            try {
                const response = await fetch(`${API_URL}/get_logs`);
                const logs = await response.json();
                const container = document.getElementById('logs');
                logs.forEach(log => {
                    const logElement = document.createElement('div');
                    logElement.className = 'text-sm';
                    logElement.textContent = log;
                    container.appendChild(logElement);
                });
                container.scrollTop = container.scrollHeight;
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function clearLogs() {
            try {
                await fetch(`${API_URL}/clear_logs`, { method: 'POST' });
                document.getElementById('logs').innerHTML = '';
            } catch (error) {
                console.error('Error:', error);
            }
        }

        document.getElementById('shareForm').addEventListener('submit', startShare);
        setInterval(updateProcesses, 1000);
        setInterval(updateLogs, 1000);
    </script>
</body>
          </html>
                  
